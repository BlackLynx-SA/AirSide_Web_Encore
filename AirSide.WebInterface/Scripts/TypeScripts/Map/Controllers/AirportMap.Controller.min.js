var AirSide;(function(n){var t;(function(n){var t;(function(n){var t=function(){function t(t){this.services=new n.Services;this.markerClusterer=new MarkerClusterer(null,null);this.language=t;this.assets=[];this.subAreas=[];this.markers=[];this.multiAssets=[];this.fbTechData=[];this.surveyorData=[];this.selectedAssets=[];this.selectedTask=0;this.lastFilter="---";this.filterEnum=0;this.filterValue="---";this.NeLat=0;this.NeLong=0;this.SwLat=0;this.SwLong=0;this.rectFlag=!1;this.initMap()}return t.prototype.initMap=function(){this.services.getMapCenter()},t.prototype.drawMap=function(){var n=15,t;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(n=14);t={center:new google.maps.LatLng(this.centerLat,this.centerLong),zoom:n,mapTypeId:google.maps.MapTypeId.SATELLITE,disableDefaultUI:!0};this.map=new google.maps.Map(document.getElementById("map-canvas"),t);this.resize()},t.prototype.resize=function(){$("#map-canvas").css("height",Math.round($(window).height()-170));$("#mapTopMenuBack").css("width",$("#map-canvas").width());$("#mapMenuItems").css("width",$("#map-canvas").width());this.map!==null&&google.maps.event.trigger(this.map,"resize")},t.prototype.addMarker=function(n){var f=this,t=this,e=n.location.longitude,o=n.location.latitude,s=new google.maps.LatLng(o,e),r="",u="",i;this.checkMultiAsset(n.assetId)?(r="/images/map_images/MultiAssetMarker.png",u=t.markerInfoForMultiAsset(n)):(r=t.getImage(n.maintenance,n.status),u=t.markerInfo(n));i=new google.maps.Marker({map:this.map,position:s,title:n.assetId.toString(),icon:r});google.maps.event.addListener(i,"click",function(){t.infoWindow&&t.infoWindow.close();t.infoWindow=new google.maps.InfoWindow({content:u});t.infoWindow.open(f.map,i)});this.markers.push(i)},t.prototype.checkMultiAsset=function(n){var t=!1;return this.multiAssets.forEach(function(i){t||i.i_assetId===n&&(t=!0)}),t},t.prototype.markerInfo=function(n){var e=this,r,u,f,i,t;return this.selectedTask!==0?$.each(n.maintenance,function(n,t){t.maintenanceId===e.selectedTask&&(r=t.previousDate,u=t.nextDate,f=t.maintenanceCycle)}):(i=n.maintenance[0],r=i.previousDate,u=i.nextDate,f=i.maintenanceCycle),t='<div class="mapInfo" style="width:300px;"><h3 class="header smaller lighter blue">'+n.serialNumber+"<small> - ("+n.rfidTag+")<\/small><\/h3>",t+='<div style="width:100%; text-align:center;"><img src="'+n.picture.fileLocation+'"/><\/div><hr/>',t+="<h5 class='txt-color-blue'>Summary<\/h4>",t+=this.language.maintenanceStatus+": "+this.getMaintenanceStatus(f)+"<br />",t+=this.language.previous+": <strong>"+r+"<\/strong><br />",t+=this.language.next+": <strong>"+u+"<\/strong><br />",t+=this.language.assetType+": <strong>"+n.assetClass.description+"<\/strong><br />",this.selectedTask===0&&(t+=this.language.maintenanceTask+": <strong>"+n.maintenance[0].maintenanceTask+"<\/strong><br />"),t+="<br/><hr/><a class='btn btn-sm btn-success' href='../../History/AssetHistory?id="+n.assetId.toString()+"'><i class='fa fa-clock-o'><\/i> "+this.language.history+"<\/a>",t+="<a class='btn btn-sm btn-primary margin-left-5' href='"+n.productUrl+"' target='_blank'><i class='fa fa-book'><\/i> "+this.language.manual+"<\/a><br />",t+="<\/ul>",t+="<hr/>",t+=n.status===!0?'<form class="smart-form"><label class="toggle"><input class="faultyLightToggle" type="checkbox" name="faultyLightToggle" data-asset-id="'+n.assetId+'_faultyToggle" checked="checked"><i data-swchon-text="ON" data-swchoff-text="OFF"><\/i>'+this.language.lightFaulty+"<\/label><\/form>":'<form class="smart-form"><label class="toggle"><input class="faultyLightToggle" type="checkbox" name="faultyLightToggle" data-asset-id="'+n.assetId+'_faultyToggle"><i data-swchon-text="ON" data-swchoff-text="OFF"><\/i>'+this.language.lightFaulty+"<\/label><\/form>",t+"<\/div>"},t.prototype.getImage=function(n,t){var u=this,i="",r=-1;if(t===!1){this.selectedTask===0?r=n[0].maintenanceCycle:$.each(n,function(n,t){t.maintenanceId===u.selectedTask&&(r=t.maintenanceCycle)});switch(r){case 0:i="/images/map_images/NutralMarker.png";break;case 1:i="/images/map_images/GreenMarker.png";break;case 2:i="/images/map_images/YellowMarker.png";break;case 3:i="/images/map_images/OrangeMarker.png";break;case 4:i="/images/map_images/RedMarker.png"}return i}return"/images/map_images/exclamation.png"},t.prototype.getMaintenanceStatus=function(n){var t="";switch(n){case 0:t="<span class='txt-color-blue'><i class='fa fa-exclamation-triangle'><\/i> "+this.language.noData+"<\/span>";break;case 1:t="<span class='txt-color-green'><i class='fa fa-thumbs-o-up'><\/i> "+this.language.updated+"<\/span>";break;case 2:t="<span class='txt-color-yellow'><i class='fa fa-ellipsis-h'><\/i> "+this.language.midCycle+"<\/span>";break;case 3:t="<span class='txt-color-orange'><i class='fa fa-bell icon-animated-bell'><\/i> "+this.language.midCycle+"<\/span>";break;case 4:t="<span class='txt-color-red'><i class='fa fa-thumbs-o-down'><\/i> "+this.language.overDue+"<\/span>"}return t},t.prototype.markerInfoForMultiAsset=function(n){var t=this,i='<div class="mapInfo" style="width:300px;"><h3 class="header smaller lighter blue"><li class="fa fa-list"><\/li> '+this.language.multiAsset+"<small> - ("+n.rfidTag+")<\/small><\/h3><hr/>";return this.getMultiAssets(n.assetId).forEach(function(r){var u=t.getAsset(r);i+='<h5><img src="'+t.getImage(n.maintenance,n.status)+'"/> '+u.serialNumber+" ( "+u.rfidTag+")<\/h5>"}),i+="<\/div>"},t.prototype.getAsset=function(n){var t=!1,i=null;return this.assets.forEach(function(r){t||r.assetId===n&&(t=!0,i=r)}),i},t.prototype.getMultiAssets=function(n){var t=[],i=!1;return this.multiAssets.forEach(function(r){i||r.i_assetId===n&&t.push(r.i_childId)}),t},t.prototype.showAllAssets=function(n){var t=this;this.markers=[];this.assets.forEach(function(n){t.selectedTask!==0?n.maintenance.forEach(function(i){i.maintenanceId===t.selectedTask&&t.addMarker(n)}):t.addMarker(n)});n&&(this.markerClusterer=new MarkerClusterer(this.map,this.markers))},t.prototype.clearAllMarkers=function(){if(this.markers!==null){for(var n=0;n<this.markers.length;n++)this.markers[n].setMap(null);this.markers=null}},t.prototype.filterAssets=function(n){var i,t,r,u;$("#assetLoader").fadeIn(500);this.clearAllMarkers();this.markerClusterer.clearMarkers();i=$("#clusteredChk").prop("checked");t="allassets";n||(t=$("input[name=assetFilterRadio]:checked").val());t=$("input[name=assetFilterRadio]:checked").val();t==="allassets"?(this.showAllAssets(i),this.filterEnum=101,this.filterValue="0"):t==="maintain"?(r=$("#maintenanceSelect").val(),this.showMaintenanceCycle(r,i),this.filterEnum=103,this.filterValue=r):t==="asset"&&(u=$("#assetClasses").val(),this.showAssetClass(u,i),this.filterEnum=102,this.filterValue=u);$("#assetFilterModal").modal("hide");$("#assetLoader").hide();this.lastFilter="assets"},t.prototype.showAssetClass=function(n,t){this.markers=[];var i=this;this.assets.forEach(function(t){n===t.assetClass.assetClassId.toString()&&t.maintenance.forEach(function(n){n.maintenanceId===i.selectedTask&&i.addMarker(t)})});t&&(this.markerClusterer=new MarkerClusterer(this.map,this.markers))},t.prototype.showMaintenanceCycle=function(n,t){var i=this;this.markers=[];this.assets.forEach(function(t){t.maintenance.forEach(function(r){r.maintenanceId===i.selectedTask&&n===r.maintenanceCycle.toString()&&i.addMarker(t)})});t&&(this.markerClusterer=new MarkerClusterer(this.map,this.markers))},t.prototype.filterSubAreas=function(n){var i=this,t=0,r="";$.each(this.subAreas,function(){i.subAreas[t].i_areaId===n&&(r+='<option value="'+i.subAreas[t].i_areaSubId+'">'+i.subAreas[t].vc_description+"<\/option>");t++});$("#subAreas").html(r)},t.prototype.filterAreas=function(){var n,t,i,r;$("#areaLoader").fadeIn(500);this.clearAllMarkers();this.markerClusterer.clearMarkers();n=$("#clusteredAreaChk").prop("checked");t=$("input[name=areaFilterRadio]:checked").val();t==="main"?(i=$("#mainAreas").val(),this.showMainAreas(i,n),this.filterEnum=104,this.filterValue=i):t==="sub"&&(r=$("#subAreas").val(),this.showSubAreas(r,n),this.filterEnum=105,this.filterValue=r);$("#areaFilterModal").modal("hide");$("#areaLoader").hide();this.lastFilter="areas"},t.prototype.showMainAreas=function(n,t){this.markers=[];var i=this;$.each(this.assets,function(t,r){r.location.areaId===n&&r.maintenance.forEach(function(n){if(n.maintenanceId===i.selectedTask)return i.addMarker(r),!1})});t&&(this.markerClusterer=new MarkerClusterer(this.map,this.markers))},t.prototype.showSubAreas=function(n,t){this.markers=[];var i=this;$.each(this.assets,function(t,r){r.location.areaSubId===n&&r.maintenance.forEach(function(n){if(n.maintenanceId===i.selectedTask)return i.addMarker(r),!1})});t&&(this.markerClusterer=new MarkerClusterer(this.map,this.markers))},t.prototype.generateFbTechContent=function(n){return'<div style="width:450px;"><div style="margin: 10px 10px 10px 10px; overflow:hidden;"><h3 class="header smaller lighter blue">'+this.language.photometricData+" <strong>"+n.tagid+'<\/strong><\/h3><div class="row"><div class="col-xs-4"><h5>Avg Cd: '+n.avgcd+'<\/h5><\/div><div class="col-xs-4"><h5>Max Cd: '+n.maxcd+'<\/h5><\/div><div class="col-xs-4"><h5>ICAO: '+n.pericao+'<\/h5><\/div><\/div><hr/><img src="'+n.picture+'" alt="Candela Chart" style="zoom:0.7;"/><\/div><\/div>'},t.prototype.processFbTechData=function(){var t=this,i=$("#failedChk").prop("checked"),n=this;this.markers=[];this.fbTechData.forEach(function(r){var o=t.generateFbTechContent(r),e=null,s,u,h,f;e=r.pass!==!1?"/Images/icons/map_icon_green.png":"/Images/icons/map_icon_red.png";i?r.pass||(h=new google.maps.LatLng(r.latitude,r.longitude),f=new google.maps.Marker({position:h,map:n.map,title:"",icon:e}),google.maps.event.addListener(f,"click",function(){n.infoWindow&&n.infoWindow.close();n.infoWindow=new google.maps.InfoWindow({content:o});n.infoWindow.open(t.map,f)}),t.markers.push(f)):(s=new google.maps.LatLng(r.latitude,r.longitude),u=new google.maps.Marker({map:t.map,position:s,title:"",icon:e}),google.maps.event.addListener(u,"click",function(){n.infoWindow&&n.infoWindow.close();n.infoWindow=new google.maps.InfoWindow({content:o});n.infoWindow.open(t.map,u)}),t.markers.push(u))});$("#photoLoader").fadeOut(500);$("#photometricFilterModal").modal("hide")},t.prototype.applyFbTechFilter=function(){this.clearAllMarkers();this.markerClusterer.clearMarkers();$("#photoLoader").fadeIn(500);var n=$("#photmetricDates").val();this.services.getFbTechData(n)},t.prototype.processSurveyData=function(){var f=$("#voiceChk").prop("checked"),e=$("#textChk").prop("checked"),o=$("#imageChk").prop("checked"),t=this,n,i,r,u;for(this.markers=[],n=0;n<this.surveyorData.length;n++)this.surveyorData[n].type==="jpg"&&o?(i=this.surveyorData[n].url,r=i.replace(".jpg","_med.jpg"),t.addSurveyorMarker(this.surveyorData[n].longitude,this.surveyorData[n].latitude,"Image",r,this.surveyorData[n].technician+" ("+this.surveyorData[n].date+")")):this.surveyorData[n].type==="text"&&e?(u=this.surveyorData[n].url,t.getTextContent(u,this.surveyorData[n].date,this.surveyorData[n].technician,this.surveyorData[n].longitude,this.surveyorData[n].latitude)):this.surveyorData[n].type==="m4a"&&f&&t.addSurveyorMarker(this.surveyorData[n].longitude,this.surveyorData[n].latitude,"Voice",this.surveyorData[n].url,this.surveyorData[n].technician+" ("+this.surveyorData[n].date+")");$("#surveyorLoader").fadeOut(500);$("#visualSurveyFilterModal").modal("hide");this.filterEnum=107},t.prototype.requestSurveyorData=function(){this.clearAllMarkers();this.markerClusterer.clearMarkers();var n=$(".from").val(),t=$(".to").val(),i=n+"-"+t;$("#surveyorLoader").fadeIn(500);this.services.getSurveyorData(i)},t.prototype.getTextContent=function(n,t,i,r,u){var f=this;$.ajax({type:"GET",url:n,success:function(n){var s='<div class="col-md-12"><h3 class="header smaller lighter pink">'+t+"<\/h3><blockquote>"+n+"<small>"+i+"<\/small><\/blockquote><\/div>",h=new google.maps.LatLng(u,r),o="",e;o=s;e=new google.maps.Marker({position:h,map:map,title:"Text",icon:"/Images/icons/map_icon_red.png"});google.maps.event.addListener(e,"click",function(){f.infoWindow&&f.infoWindow.close();f.infoWindow=new google.maps.InfoWindow({content:o});f.infoWindow.open(map,e)});markers.push(e)}})},t.prototype.createSurveyorContent=function(n,t,i){var r="";return n==="Image"?(r+='<div class="col-md-12"><h4 class="header smaller lighter green"><i class="green icon-picture"><\/i> '+this.language.imagesTaken+"<\/h4>",r+='<div class="col-md-12"><img src="'+t+'" style="width: 250px; height: 250px;"/><\/div>',r+='<br/><div class="col-md-12"><span> - '+i+"<\/span><\/div><hr/><\/div>"):n==="Voice"&&(r+='<div class="col-md-12"><h4 class="header smaller lighter blue"><i class="blue icon-microphone"><\/i> '+this.language.voiceMemos+"<\/h4><\/div>",r+='<audio width="100%" height="32" style="width:100%;" controls="controls" preload="none">',r+='<source src="'+t+'" type="audio/mp4"><\/audio><hr />',r+='<div class="col-md-12"><span> - '+i+"<\/span><\/div>"),r},t.prototype.filterFaulty=function(){this.clearAllMarkers();this.markerClusterer.clearMarkers();var n=this;this.markers=[];this.assets.forEach(function(t){t.status===!0&&n.addMarker(t)});this.filterEnum=106;$("#visualSurveyFilterModal").modal("hide")},t.prototype.addSurveyorMarker=function(n,t,i,r,u){var h=new google.maps.LatLng(t,n),s="",o="",f=this,e;i==="Image"?o="/Images/icons/map_icon_green.png":i==="Voice"&&(o="/Images/icons/map_icon_blue.png");s=this.createSurveyorContent(i,r,u);e=new google.maps.Marker({position:h,map:f.map,title:i,icon:o});google.maps.event.addListener(e,"click",function(){f.infoWindow&&f.infoWindow.close();f.infoWindow=new google.maps.InfoWindow({content:s});f.infoWindow.open(f.map,e)});this.markers.push(e)},t.prototype.showRectangle=function(){if(this.rectFlag)this.rectangle.setMap(null),this.rectFlag=!1,$(".createShift").addClass("disabled");else{var n=this.map.getCenter(),t=new google.maps.LatLngBounds(new google.maps.LatLng(n.lat()-.001,n.lng()-.002),new google.maps.LatLng(n.lat()+.001,n.lng()+.002));this.rectangle=new google.maps.Rectangle({bounds:t,editable:!0,draggable:!0});this.rectangle.setMap(this.map);this.rectFlag=!0;$(".createShift").removeClass("disabled")}},t.prototype.getSelectedAssets=function(){var o,i,n;this.selectedAssets=[];var t=this,r=this.rectangle.bounds.getNorthEast().lat(),u=this.rectangle.bounds.getNorthEast().lng(),f=this.rectangle.bounds.getSouthWest().lat(),e=this.rectangle.bounds.getSouthWest().lng();this.NeLat=r;this.NeLong=u;this.SwLat=f;this.SwLong=e;this.markers.forEach(function(n){var i=0,o=0,s,h;i=n.position.lat();o=n.position.lng();s=!1;h=!1;i>=f&&i<=r&&(s=!0);o>=e&&o<=u&&(h=!0);s&&h&&t.selectedAssets.push(n)});o=[];t.selectedAssets.forEach(function(n){o.push(n.title)});t.selectedAssets.length>0?(i=$("#shiftdate"),i.datepicker(),n=new Date,i.datepicker("setDate",new Date(n.getFullYear(),n.getMonth(),n.getDate())),$("#techModalLabel").html('<i class="fa fa-calendar txt-color-blueDark"><\/i> '+this.language.createNewShift+" "+this.selectedAssets.length+" assets"),$("#shiftModal").modal("show")):$.smallBox({title:this.language.noAssets,content:this.language.selectAssets,color:"#dfb56c",timeout:4e3,icon:"fa fa-warning swing animated"})},t.prototype.sendCustomShift=function(){var i=this,r;$("#shiftLoader").fadeIn(300);var h=$("#shiftdate").val(),c=$("#timepicker").val(),u=h+" "+c,f=$("#techgroups").val(),e=$("#shiftTasks").val(),n=$("#externalRefTxt").val(),t=$("#workpermitTxt").val(),o=this.selectedTask,s=$("input[name='__RequestVerificationToken']").val();if(n===""&&(n="---"),t===""&&(t="---"),r={shift:{scheduledDate:u,techGroupId:f,maintenanceId:e,permitNumber:t,externalRef:n,filterType:this.filterEnum,filterValue:this.filterValue,maintenanceFilter:o,dateRange:"",voiceChk:!1,textChk:!1,imageChk:!1},bounds:{NELat:this.NeLat,NELong:this.NeLong,SWLat:this.SwLat,SWLong:this.SwLong},__RequestVerificationToken:s},this.filterEnum===107){var l=$(".from").val(),a=$(".to").val(),v=l+"-"+a,y=$("#voiceChk").prop("checked"),p=$("#textChk").prop("checked"),w=$("#imageChk").prop("checked");r={shift:{scheduledDate:u,techGroupId:f,maintenanceId:e,permitNumber:t,externalRef:n,filterType:this.filterEnum,filterValue:this.filterValue,maintenanceFilter:o,dateRange:v,voiceChk:y,textChk:p,imageChk:w},bounds:{NELat:this.NeLat,NELong:this.NeLong,SWLat:this.SwLat,SWLong:this.SwLong},__RequestVerificationToken:s}}$.ajax({url:"../../Shifts/addCustomShift",data:r,type:"post",dataType:"json",success:function(n){$.smallBox({title:i.language.shiftCreated,content:n.count+" "+i.language.customShiftCreated,color:"#5384AF",timeout:4e3,icon:"fa fa-calendar"});$("#shiftLoader").fadeOut(300);$("#shiftModal").modal("hide")},error:function(n){$.smallBox({title:i.language.errorCustomShift,content:n.responseText,color:"#f51414",timeout:5e3,icon:"fa fa-bell swing animated"})}})},t.prototype.applySearchFilter=function(){var n=$("#search-fld").val(),t=this;clearAllMarkers();this.markerClusterer.clearMarkers();this.markers=[];this.assets.forEach(function(i){var r=i.serialNumber.toLowerCase(),u=i.rfidTag.toLowerCase();(r.indexOf(n.toLowerCase())>=0||u.indexOf(n.toLowerCase())>=0)&&t.addMarker(i)})},t.prototype.toggleFaultyLight=function(n,t){var i=this;this.assets.forEach(function(r){if(r.assetId.toString()===n){r.status=t;var u=0;markers.forEach(function(n){n.title===r.assetId.toString()&&markers[u].setMap(null);u++});i.addMarker(r)}})},t}();n.Controller=t})(t=n.AirportMap||(n.AirportMap={}))})(t=n.Encore||(n.Encore={}))})(AirSide||(AirSide={}));